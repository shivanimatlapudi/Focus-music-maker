<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Music Maker</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Departure+Mono&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500&display=swap" rel="stylesheet">
  <!-- Tone.js for audio synthesis -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
  <style>
    @font-face {
      font-family: 'Departure Mono';
      src: url('https://fonts.cdnfonts.com/s/95903/DepartureMono-Regular.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      background: #ffffff;
      height: 100dvh; /* Dynamic viewport height for mobile */
      max-height: 100dvh;
      overflow: hidden; /* No scrolling */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      gap: 16px;
    }

    .timer-display {
      font-family: 'Geist', sans-serif;
      font-size: clamp(48px, 12vw, 148px); /* Responsive font size */
      font-weight: 500;
      color: #222;
      opacity: 0.1;
      line-height: 1;
      user-select: none;
      transition: opacity 0.3s ease;
      font-variant-numeric: tabular-nums;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-shrink: 0;
    }

    .timer-display.active {
      opacity: 1;
    }

    .timer-digit {
      display: inline-block;
      position: relative;
      overflow: hidden;
      width: 0.6em;
      height: 1.15em;
      text-align: center;
      background: transparent;
    }

    .timer-digit-inner {
      display: block;
      will-change: transform, opacity, filter;
    }

    .timer-digit-inner.changing {
      animation: digitSlideIn 0.35s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }

    @keyframes digitSlideIn {
      0% {
        transform: translateY(50%);
        opacity: 0;
        filter: blur(12px);
      }
      60% {
        transform: translateY(5%);
        opacity: 0;
        filter: blur(8px);
      }
      100% {
        transform: translateY(0);
        opacity: 1;
        filter: blur(0);
      }
    }

    .timer-colon {
      display: inline-block;
      width: 0.3em;
      text-align: center;
    }

    .controls {
      display: flex;
      gap: 16px;
      align-items: center;
      flex-shrink: 0;
    }

    .time-selector {
      background: #FFF;
      border: 1px solid #E3E3E3;
      border-radius: 40px;
      padding: 8px 16px;
      height: 49px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.05);
      box-sizing: border-box;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
    }

    .time-selector:active {
      transform: scale(0.97);
      box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.05);
    }

    .arrow-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 12px;
      height: 12px;
      color: #000;
      transition: transform 0.1s ease;
    }

    .arrow-btn:active {
      transform: scale(0.85);
    }

    .arrow-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .time-value {
      font-family: 'Geist', sans-serif;
      font-size: 14px;
      font-weight: 500;
      color: #000;
      cursor: pointer;
      user-select: none;
      line-height: normal;
    }

    .start-btn {
      background: #050000;
      border: none;
      border-radius: 40px;
      padding: 8px 24px;
      height: 49px;
      font-family: 'Geist', sans-serif;
      font-size: 14px;
      font-weight: 500;
      color: #ddd;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.05);
      line-height: normal;
      box-sizing: border-box;
    }

    .start-btn:active {
      transform: scale(0.97);
      box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.03);
    }

    .timer-controls {
      display: flex;
      gap: 24px;
      align-items: center;
    }

    .restart-btn {
      background: #FFF;
      border: 1px solid #E3E3E3;
      border-radius: 40px;
      padding: 8px 24px;
      height: 49px;
      font-family: 'Geist', sans-serif;
      font-size: 14px;
      font-weight: 500;
      color: #000;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
      box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.05);
      line-height: normal;
      box-sizing: border-box;
    }

    .restart-btn:active {
      transform: scale(0.97);
      box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.05);
    }

    .pause-btn {
      background: #050000;
      border: none;
      border-radius: 40px;
      padding: 8px 24px;
      height: 49px;
      box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.05);
      line-height: normal;
      box-sizing: border-box;
      font-family: 'Geist', sans-serif;
      font-size: 14px;
      font-weight: 500;
      color: #ddd;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease;
    }

    .pause-btn:active {
      transform: scale(0.97);
      box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.03);
    }

    .device {
      width: 380px;
      height: 450px;
      background: #efefef;
      border: 1px solid #f1f1f1;
      border-radius: 28px;
      position: relative;
      flex-shrink: 0;
      transform-origin: center center;
    }

    .device-top {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 257px;
      background: linear-gradient(171deg, #C6C6C6 -4.92%, #E0E0E0 4.76%, #F6F6F6 85.82%);
      border: 1px solid #F1F1F1;
      border-radius: 24px 24px 4px 4px;
      padding: 12px 10px;
      box-shadow: -3px -2px 3px 0 rgba(255, 255, 255, 0.25) inset;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .screen-container {
      background: #050000;
      border: 1px solid #dbdbdb;
      border-radius: 16px;
      padding: 11px 10px;
      width: 356px;
      height: 232px;
      position: relative;
    }

    .screen-container::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      box-shadow: inset -3px -2px 3px 0px rgba(255, 255, 255, 0.25);
    }

    .pixel-grid {
      display: grid;
      grid-template-columns: repeat(16, 1fr);
      grid-template-rows: repeat(10, 1fr);
      gap: 1px;
      width: 100%;
      height: 100%;
    }

    .pixel {
      background: #292929;
      border-radius: 4px;
      aspect-ratio: 1;
      transition: background-color 0.05s ease, transform 0.08s ease;
      cursor: pointer;
    }

    .pixel:hover {
      background: #3a3a3a;
    }

    .pixel:active {
      transform: scale(0.92);
    }

    .pixel.active {
      background: #e4e4e4;
      border-radius: 4px;
    }

    .pixel.active:hover {
      background: #d4d4d4;
    }

    .pixel.current-step {
      background: #171717;
    }

    .pixel.active.current-step {
      background: #ffffff;
    }

    .device-bottom {
      position: absolute;
      top: 259px;
      left: 0;
      right: 0;
      height: 189px;
      background: linear-gradient(357deg, #C6C6C6 -13.02%, #E0E0E0 12.25%, #F6F6F6 100%);
      border: 1px solid #F1F1F1;
      border-radius: 4px 4px 24px 24px;
      padding: 24px;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: -3px -2px 3px 0 rgba(255, 255, 255, 0.25) inset;
    }

    .speaker {
      margin-bottom: 26px;
    }

    .speaker svg {
      width: 89.166px;
      height: 38.665px;
    }

    .buttons-container {
      width: 334px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto; /* Push to bottom, 24px from device edge (via padding) */
    }

    .tempo-control {
      position: relative;
      width: 40px;
      height: 80px;
    }

    .tempo-track {
      position: absolute;
      left: 16px;
      top: 0;
      width: 8px;
      height: 80px;
      background: #222;
      opacity: 0.2;
      border: 1px solid #b0b0b0;
      border-radius: 16px;
      box-shadow: inset 3px 2px 2px 0px rgba(0, 0, 0, 0.65);
    }

    .tempo-knob {
      position: absolute;
      left: 0;
      width: 40px;
      height: 24px;
      background: #222;
      border: 3px solid #e3e3e3;
      border-radius: 16px;
      box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);
      cursor: grab;
      transition: top 0.05s ease;
    }

    .tempo-knob:active {
      cursor: grabbing;
    }

    .tempo-label {
      display: none;
    }

    .play-button {
      width: 80px;
      height: 80px;
      background: linear-gradient(177deg, #C6C6C6 -78%, #E0E0E0 68.13%, #F6F6F6 100%);
      border: 3px solid #F1F1F1;
      border-radius: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.25), -3px -2px 3px 0 rgba(255, 255, 255, 0.25) inset;
      cursor: pointer;
      transition: transform 0.1s ease;
      position: relative;
    }

    .play-button:active {
      transform: scale(0.97);
    }

    .play-button svg {
      width: 16px;
      height: 16px;
      position: relative;
      z-index: 1;
    }

    .footer-controls {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .footer-icon-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      border-radius: 40px;
      background: none;
      border: none;
      cursor: pointer;
      opacity: 0.5;
      transition: opacity 0.2s ease, transform 0.1s ease;
      position: relative;
    }

    .footer-icon-btn:hover {
      opacity: 1;
    }

    .footer-icon-btn:active {
      transform: scale(0.95);
    }

    .footer-icon-btn svg {
      width: 20px;
      height: 20px;
    }

    .footer-icon-btn svg path {
      fill: #000;
      transition: fill 0.2s ease;
    }

    .footer-icon-btn:hover svg path {
      fill: #000;
    }

    .footer-icon-btn.active svg path {
      fill: #ff6b6b;
    }

    /* =====================================================
       RESPONSIVE STYLES
       ===================================================== */
    
    /* Wrapper for scaling the device */
    .device-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      flex: 1;
      min-height: 0; /* Allow shrinking */
      width: 100%;
    }

    /* Small phones (< 400px width or < 700px height) */
    @media screen and (max-width: 400px), screen and (max-height: 700px) {
      body {
        padding: 12px;
        padding-top: 24px;
        gap: 6px;
      }
      
      .timer-display {
        font-size: clamp(32px, 10vw, 64px);
        padding-top: 10px;
      }
      
      .controls {
        gap: 10px;
      }
      
      .time-selector {
        height: 40px;
        padding: 6px 12px;
      }
      
      .start-btn, .pause-btn, .restart-btn {
        height: 40px;
        padding: 6px 16px;
        font-size: 13px;
      }
      
      .device-wrapper {
        margin-top: -10px;
      }
      
      .device {
        transform: scale(0.75);
        margin: -50px 0; /* Compensate for scale */
      }
      
      .footer-controls {
        gap: 12px;
      }
      
      .footer-icon-btn {
        width: 40px;
        height: 40px;
      }
    }

    /* Very small phones (< 360px width or < 600px height) */
    @media screen and (max-width: 360px), screen and (max-height: 600px) {
      body {
        padding-top: 20px;
        gap: 4px;
      }
      
      .timer-display {
        font-size: clamp(28px, 9vw, 48px);
        padding-top: 8px;
      }
      
      .device-wrapper {
        margin-top: -15px;
      }
      
      .device {
        transform: scale(0.65);
        margin: -70px 0;
      }
    }

    /* Medium screens (tablets in portrait) */
    @media screen and (min-width: 401px) and (max-width: 768px) {
      .device {
        transform: scale(0.9);
      }
    }

    /* Ensure viewport fits on very short screens */
    @media screen and (max-height: 550px) {
      body {
        padding-top: 16px;
        gap: 2px;
      }
      
      .timer-display {
        font-size: 28px;
        padding-top: 5px;
      }
      
      .device-wrapper {
        margin-top: -20px;
      }
      
      .device {
        transform: scale(0.55);
        margin: -90px 0;
      }
      
      .controls {
        gap: 8px;
      }
      
      .time-selector, .start-btn, .pause-btn, .restart-btn {
        height: 36px;
        padding: 4px 12px;
        font-size: 12px;
      }
    }

  </style>
</head>
<body>
  <div class="timer-display" id="timer">00:00:00</div>
  
  <div class="controls">
    <!-- Time selector (shown when timer not running) -->
    <div class="time-selector" id="timeSelector">
      <button class="arrow-btn" id="decreaseTime">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
          <path d="M7.5 2.5L4 6L7.5 9.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <span class="time-value" id="timeValue">15 mins</span>
      <button class="arrow-btn" id="increaseTime">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
          <path d="M4.5 2.5L8 6L4.5 9.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <button class="start-btn" id="startBtn">Start timer</button>
    
    <!-- Timer controls (shown when timer is running) -->
    <div class="timer-controls" id="timerControls" style="display: none;">
      <button class="restart-btn" id="restartBtn">Restart</button>
      <button class="pause-btn" id="pauseBtn">Pause</button>
    </div>
  </div>

  <div class="device-wrapper">
  <div class="device">
    <div class="device-top">
      <div class="screen-container">
        <div class="pixel-grid" id="pixelGrid">
          <!-- Pixels will be generated by JavaScript -->
        </div>
      </div>
    </div>
    
    <div class="device-bottom">
      <div class="speaker">
        <svg xmlns="http://www.w3.org/2000/svg" width="90" height="40" viewBox="0 0 90 40" fill="none">
  <g filter="url(#filter0_d_65_20)">
    <circle cx="11.4417" cy="10.6527" r="1.9727" transform="rotate(-180 11.4417 10.6527)" fill="url(#paint0_linear_65_20)"/>
  </g>
  <g filter="url(#filter1_d_65_20)">
    <circle cx="11.4417" cy="28.0125" r="1.9727" transform="rotate(-180 11.4417 28.0125)" fill="url(#paint1_linear_65_20)"/>
  </g>
  <g filter="url(#filter2_d_65_20)">
    <circle cx="49.3176" cy="10.6527" r="1.9727" transform="rotate(-180 49.3176 10.6527)" fill="url(#paint2_linear_65_20)"/>
  </g>
  <g filter="url(#filter3_d_65_20)">
    <circle cx="49.3176" cy="28.0125" r="1.9727" transform="rotate(-180 49.3176 28.0125)" fill="url(#paint3_linear_65_20)"/>
  </g>
  <g filter="url(#filter4_d_65_20)">
    <circle cx="30.3797" cy="10.6527" r="1.9727" transform="rotate(-180 30.3797 10.6527)" fill="url(#paint4_linear_65_20)"/>
  </g>
  <g filter="url(#filter5_d_65_20)">
    <circle cx="30.3797" cy="28.0125" r="1.9727" transform="rotate(-180 30.3797 28.0125)" fill="url(#paint5_linear_65_20)"/>
  </g>
  <g filter="url(#filter6_d_65_20)">
    <circle cx="68.2556" cy="10.6527" r="1.9727" transform="rotate(-180 68.2556 10.6527)" fill="url(#paint6_linear_65_20)"/>
  </g>
  <g filter="url(#filter7_d_65_20)">
    <circle cx="68.2556" cy="28.0125" r="1.9727" transform="rotate(-180 68.2556 28.0125)" fill="url(#paint7_linear_65_20)"/>
  </g>
  <g filter="url(#filter8_d_65_20)">
    <circle cx="11.4417" cy="19.3325" r="1.9727" transform="rotate(-180 11.4417 19.3325)" fill="url(#paint8_linear_65_20)"/>
  </g>
  <g filter="url(#filter9_d_65_20)">
    <circle cx="1.97273" cy="19.3325" r="1.9727" transform="rotate(-180 1.97273 19.3325)" fill="url(#paint9_linear_65_20)"/>
  </g>
  <g filter="url(#filter10_d_65_20)">
    <circle cx="87.1936" cy="19.3325" r="1.9727" transform="rotate(-180 87.1936 19.3325)" fill="url(#paint10_linear_65_20)"/>
  </g>
  <g filter="url(#filter11_d_65_20)">
    <circle cx="49.3176" cy="19.3325" r="1.9727" transform="rotate(-180 49.3176 19.3325)" fill="url(#paint11_linear_65_20)"/>
  </g>
  <g filter="url(#filter12_d_65_20)">
    <circle cx="49.3176" cy="36.6923" r="1.9727" transform="rotate(-180 49.3176 36.6923)" fill="url(#paint12_linear_65_20)"/>
  </g>
  <g filter="url(#filter13_d_65_20)">
    <circle cx="49.3176" cy="1.97273" r="1.9727" transform="rotate(-180 49.3176 1.97273)" fill="url(#paint13_linear_65_20)"/>
  </g>
  <g filter="url(#filter14_d_65_20)">
    <circle cx="30.3797" cy="19.3325" r="1.9727" transform="rotate(-180 30.3797 19.3325)" fill="url(#paint14_linear_65_20)"/>
  </g>
  <g filter="url(#filter15_d_65_20)">
    <circle cx="30.3797" cy="36.6923" r="1.9727" transform="rotate(-180 30.3797 36.6923)" fill="url(#paint15_linear_65_20)"/>
  </g>
  <g filter="url(#filter16_d_65_20)">
    <circle cx="68.2556" cy="19.3325" r="1.9727" transform="rotate(-180 68.2556 19.3325)" fill="url(#paint16_linear_65_20)"/>
  </g>
  <g filter="url(#filter17_d_65_20)">
    <circle cx="30.3797" cy="1.97273" r="1.9727" transform="rotate(-180 30.3797 1.97273)" fill="url(#paint17_linear_65_20)"/>
  </g>
  <g filter="url(#filter18_d_65_20)">
    <circle cx="20.9107" cy="10.6527" r="1.9727" transform="rotate(-180 20.9107 10.6527)" fill="url(#paint18_linear_65_20)"/>
  </g>
  <g filter="url(#filter19_d_65_20)">
    <circle cx="20.9107" cy="28.0125" r="1.9727" transform="rotate(-180 20.9107 28.0125)" fill="url(#paint19_linear_65_20)"/>
  </g>
  <g filter="url(#filter20_d_65_20)">
    <circle cx="58.7866" cy="10.6527" r="1.9727" transform="rotate(-180 58.7866 10.6527)" fill="url(#paint20_linear_65_20)"/>
  </g>
  <g filter="url(#filter21_d_65_20)">
    <circle cx="58.7866" cy="28.0125" r="1.9727" transform="rotate(-180 58.7866 28.0125)" fill="url(#paint21_linear_65_20)"/>
  </g>
  <g filter="url(#filter22_d_65_20)">
    <circle cx="39.8486" cy="10.6527" r="1.9727" transform="rotate(-180 39.8486 10.6527)" fill="url(#paint22_linear_65_20)"/>
  </g>
  <g filter="url(#filter23_d_65_20)">
    <circle cx="39.8486" cy="28.0125" r="1.9727" transform="rotate(-180 39.8486 28.0125)" fill="url(#paint23_linear_65_20)"/>
  </g>
  <g filter="url(#filter24_d_65_20)">
    <circle cx="77.7246" cy="10.6527" r="1.9727" transform="rotate(-180 77.7246 10.6527)" fill="url(#paint24_linear_65_20)"/>
  </g>
  <g filter="url(#filter25_d_65_20)">
    <circle cx="77.7246" cy="28.0125" r="1.9727" transform="rotate(-180 77.7246 28.0125)" fill="url(#paint25_linear_65_20)"/>
  </g>
  <g filter="url(#filter26_d_65_20)">
    <circle cx="20.9107" cy="19.3325" r="1.9727" transform="rotate(-180 20.9107 19.3325)" fill="url(#paint26_linear_65_20)"/>
  </g>
  <g filter="url(#filter27_d_65_20)">
    <circle cx="58.7866" cy="19.3325" r="1.9727" transform="rotate(-180 58.7866 19.3325)" fill="url(#paint27_linear_65_20)"/>
  </g>
  <g filter="url(#filter28_d_65_20)">
    <circle cx="58.7866" cy="36.6923" r="1.9727" transform="rotate(-180 58.7866 36.6923)" fill="url(#paint28_linear_65_20)"/>
  </g>
  <g filter="url(#filter29_d_65_20)">
    <circle cx="58.7866" cy="1.97273" r="1.9727" transform="rotate(-180 58.7866 1.97273)" fill="url(#paint29_linear_65_20)"/>
  </g>
  <g filter="url(#filter30_d_65_20)">
    <circle cx="39.8488" cy="19.3305" r="1.9727" transform="rotate(-180 39.8488 19.3305)" fill="url(#paint30_linear_65_20)"/>
  </g>
  <g filter="url(#filter31_d_65_20)">
    <circle cx="39.8486" cy="36.6923" r="1.9727" transform="rotate(-180 39.8486 36.6923)" fill="url(#paint31_linear_65_20)"/>
  </g>
  <g filter="url(#filter32_d_65_20)">
    <circle cx="77.7246" cy="19.3325" r="1.9727" transform="rotate(-180 77.7246 19.3325)" fill="url(#paint32_linear_65_20)"/>
  </g>
  <g filter="url(#filter33_d_65_20)">
    <circle cx="39.8486" cy="1.97273" r="1.9727" transform="rotate(-180 39.8486 1.97273)" fill="url(#paint33_linear_65_20)"/>
  </g>
  <defs>
    <filter id="filter0_d_65_20" x="9.46899" y="8.67993" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter1_d_65_20" x="9.46899" y="26.0397" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter2_d_65_20" x="47.3449" y="8.67993" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter3_d_65_20" x="47.3449" y="26.0397" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter4_d_65_20" x="28.407" y="8.67993" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter5_d_65_20" x="28.407" y="26.0397" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter6_d_65_20" x="66.2829" y="8.67993" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter7_d_65_20" x="66.2828" y="26.0397" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter8_d_65_20" x="9.46899" y="17.3598" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter9_d_65_20" x="0" y="17.3598" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter10_d_65_20" x="85.2208" y="17.3598" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter11_d_65_20" x="47.3449" y="17.3598" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter12_d_65_20" x="47.3449" y="34.7196" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter13_d_65_20" x="47.3449" y="0" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter14_d_65_20" x="28.407" y="17.3598" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter15_d_65_20" x="28.407" y="34.7196" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter16_d_65_20" x="66.2828" y="17.3598" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter17_d_65_20" x="28.407" y="0" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter18_d_65_20" x="18.938" y="8.67993" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter19_d_65_20" x="18.938" y="26.0397" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter20_d_65_20" x="56.8139" y="8.67993" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter21_d_65_20" x="56.8139" y="26.0397" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter22_d_65_20" x="37.8759" y="8.67993" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter23_d_65_20" x="37.8759" y="26.0397" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter24_d_65_20" x="75.7518" y="8.67993" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter25_d_65_20" x="75.7518" y="26.0397" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter26_d_65_20" x="18.938" y="17.3598" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter27_d_65_20" x="56.8139" y="17.3598" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter28_d_65_20" x="56.8139" y="34.7196" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter29_d_65_20" x="56.8139" y="0" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter30_d_65_20" x="37.8761" y="17.3578" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter31_d_65_20" x="37.8759" y="34.7196" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter32_d_65_20" x="75.7518" y="17.3598" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <filter id="filter33_d_65_20" x="37.8759" y="0" width="4.34543" height="4.34543" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix"/>
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
      <feOffset dx="0.4" dy="0.4"/>
      <feComposite in2="hardAlpha" operator="out"/>
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_65_20"/>
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_65_20" result="shape"/>
    </filter>
    <linearGradient id="paint0_linear_65_20" x1="11.4417" y1="8.67996" x2="11.4417" y2="12.6254" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint1_linear_65_20" x1="11.4417" y1="26.0398" x2="11.4417" y2="29.9852" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint2_linear_65_20" x1="49.3176" y1="8.67996" x2="49.3176" y2="12.6254" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint3_linear_65_20" x1="49.3176" y1="26.0398" x2="49.3176" y2="29.9852" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint4_linear_65_20" x1="30.3797" y1="8.67996" x2="30.3797" y2="12.6254" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint5_linear_65_20" x1="30.3797" y1="26.0398" x2="30.3797" y2="29.9852" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint6_linear_65_20" x1="68.2556" y1="8.67996" x2="68.2556" y2="12.6254" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint7_linear_65_20" x1="68.2556" y1="26.0398" x2="68.2556" y2="29.9852" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint8_linear_65_20" x1="11.4417" y1="17.3598" x2="11.4417" y2="21.3052" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint9_linear_65_20" x1="1.97273" y1="17.3598" x2="1.97273" y2="21.3052" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint10_linear_65_20" x1="87.1936" y1="17.3598" x2="87.1936" y2="21.3052" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint11_linear_65_20" x1="49.3176" y1="17.3598" x2="49.3176" y2="21.3052" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint12_linear_65_20" x1="49.3176" y1="34.7196" x2="49.3176" y2="38.665" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint13_linear_65_20" x1="49.3176" y1="2.51532e-05" x2="49.3176" y2="3.94543" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint14_linear_65_20" x1="30.3797" y1="17.3598" x2="30.3797" y2="21.3052" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint15_linear_65_20" x1="30.3797" y1="34.7196" x2="30.3797" y2="38.665" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint16_linear_65_20" x1="68.2556" y1="17.3598" x2="68.2556" y2="21.3052" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint17_linear_65_20" x1="30.3797" y1="2.51532e-05" x2="30.3797" y2="3.94543" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint18_linear_65_20" x1="20.9107" y1="8.67996" x2="20.9107" y2="12.6254" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint19_linear_65_20" x1="20.9107" y1="26.0398" x2="20.9107" y2="29.9852" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint20_linear_65_20" x1="58.7866" y1="8.67996" x2="58.7866" y2="12.6254" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint21_linear_65_20" x1="58.7866" y1="26.0398" x2="58.7866" y2="29.9852" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint22_linear_65_20" x1="39.8486" y1="8.67996" x2="39.8486" y2="12.6254" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint23_linear_65_20" x1="39.8486" y1="26.0398" x2="39.8486" y2="29.9852" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint24_linear_65_20" x1="77.7246" y1="8.67996" x2="77.7246" y2="12.6254" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint25_linear_65_20" x1="77.7246" y1="26.0398" x2="77.7246" y2="29.9852" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint26_linear_65_20" x1="20.9107" y1="17.3598" x2="20.9107" y2="21.3052" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint27_linear_65_20" x1="58.7866" y1="17.3598" x2="58.7866" y2="21.3052" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint28_linear_65_20" x1="58.7866" y1="34.7196" x2="58.7866" y2="38.665" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint29_linear_65_20" x1="58.7866" y1="2.51532e-05" x2="58.7866" y2="3.94543" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint30_linear_65_20" x1="39.8488" y1="17.3578" x2="39.8488" y2="21.3032" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint31_linear_65_20" x1="39.8486" y1="34.7196" x2="39.8486" y2="38.665" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint32_linear_65_20" x1="77.7246" y1="17.3598" x2="77.7246" y2="21.3052" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
    <linearGradient id="paint33_linear_65_20" x1="39.8486" y1="2.51532e-05" x2="39.8486" y2="3.94543" gradientUnits="userSpaceOnUse">
      <stop stop-color="#414141"/>
      <stop offset="1"/>
    </linearGradient>
  </defs>
</svg>
      </div>
      
      <div class="buttons-container">
        <div class="tempo-control">
          <div class="tempo-track"></div>
          <div class="tempo-knob" id="tempoKnob"></div>
          <div class="tempo-label" id="tempoLabel">70 BPM</div>
        </div>
        
        <div class="play-button" id="playBtn">
          <svg id="playIcon" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 2L14 8L4 14V2Z" fill="#222" stroke="#222" stroke-width="1.5" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
    </div>
  </div>
  </div>

  <div class="footer-controls">
    <!-- Randomise button - Waveform icon -->
    <button class="footer-icon-btn" id="randomiseBtn" data-tooltip="Randomise">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M4.375 7.5V12.5C4.375 12.6658 4.30915 12.8247 4.19194 12.9419C4.07473 13.0592 3.91576 13.125 3.75 13.125C3.58424 13.125 3.42527 13.0592 3.30806 12.9419C3.19085 12.8247 3.125 12.6658 3.125 12.5V7.5C3.125 7.33424 3.19085 7.17527 3.30806 7.05806C3.42527 6.94085 3.58424 6.875 3.75 6.875C3.91576 6.875 4.07473 6.94085 4.19194 7.05806C4.30915 7.17527 4.375 7.33424 4.375 7.5ZM6.875 1.875C6.70924 1.875 6.55027 1.94085 6.43306 2.05806C6.31585 2.17527 6.25 2.33424 6.25 2.5V17.5C6.25 17.6658 6.31585 17.8247 6.43306 17.9419C6.55027 18.0592 6.70924 18.125 6.875 18.125C7.04076 18.125 7.19973 18.0592 7.31694 17.9419C7.43415 17.8247 7.5 17.6658 7.5 17.5V2.5C7.5 2.33424 7.43415 2.17527 7.31694 2.05806C7.19973 1.94085 7.04076 1.875 6.875 1.875ZM10 4.375C9.83424 4.375 9.67527 4.44085 9.55806 4.55806C9.44085 4.67527 9.375 4.83424 9.375 5V15C9.375 15.1658 9.44085 15.3247 9.55806 15.4419C9.67527 15.5592 9.83424 15.625 10 15.625C10.1658 15.625 10.3247 15.5592 10.4419 15.4419C10.5592 15.3247 10.625 15.1658 10.625 15V5C10.625 4.83424 10.5592 4.67527 10.4419 4.55806C10.3247 4.44085 10.1658 4.375 10 4.375ZM13.125 6.875C12.9592 6.875 12.8003 6.94085 12.6831 7.05806C12.5658 7.17527 12.5 7.33424 12.5 7.5V12.5C12.5 12.6658 12.5658 12.8247 12.6831 12.9419C12.8003 13.0592 12.9592 13.125 13.125 13.125C13.2908 13.125 13.4497 13.0592 13.5669 12.9419C13.6842 12.8247 13.75 12.6658 13.75 12.5V7.5C13.75 7.33424 13.6842 7.17527 13.5669 7.05806C13.4497 6.94085 13.2908 6.875 13.125 6.875ZM16.25 5.625C16.0842 5.625 15.9253 5.69085 15.8081 5.80806C15.6908 5.92527 15.625 6.08424 15.625 6.25V13.75C15.625 13.9158 15.6908 14.0747 15.8081 14.1919C15.9253 14.3092 16.0842 14.375 16.25 14.375C16.4158 14.375 16.5747 14.3092 16.6919 14.1919C16.8092 14.0747 16.875 13.9158 16.875 13.75V6.25C16.875 6.08424 16.8092 5.92527 16.6919 5.80806C16.5747 5.69085 16.4158 5.625 16.25 5.625Z"/>
      </svg>
    </button>
    
    <!-- Clear button - Arrow clockwise icon -->
    <button class="footer-icon-btn" id="clearBtn" data-tooltip="Clear">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M18.7499 4.37527V8.12527C18.7499 8.29103 18.6841 8.45001 18.5669 8.56722C18.4497 8.68443 18.2907 8.75027 18.1249 8.75027H14.3749C14.2092 8.75027 14.0502 8.68443 13.933 8.56722C13.8158 8.45001 13.7499 8.29103 13.7499 8.12527C13.7499 7.95951 13.8158 7.80054 13.933 7.68333C14.0502 7.56612 14.2092 7.50027 14.3749 7.50027H16.5156L14.4382 5.59715L14.4187 5.5784C13.55 4.71003 12.4447 4.11688 11.2408 3.87304C10.037 3.62921 8.78798 3.7455 7.64984 4.20738C6.5117 4.66927 5.5349 5.45628 4.84144 6.47009C4.14798 7.4839 3.76863 8.67957 3.75076 9.90773C3.73289 11.1359 4.0773 12.3421 4.74097 13.3756C5.40463 14.4092 6.35813 15.2243 7.48235 15.7191C8.60657 16.2139 9.85166 16.3665 11.0621 16.1578C12.2725 15.9491 13.3946 15.3883 14.2882 14.5456C14.4087 14.4316 14.5695 14.3702 14.7353 14.3748C14.9011 14.3794 15.0582 14.4497 15.1722 14.5702C15.2862 14.6907 15.3476 14.8515 15.343 15.0173C15.3384 15.1831 15.2681 15.3402 15.1476 15.4542C13.7581 16.7719 11.9149 17.5046 9.99993 17.5003H9.8968C8.66847 17.4834 7.46308 17.1652 6.38656 16.5734C5.31005 15.9816 4.39538 15.1345 3.72294 14.1064C3.0505 13.0784 2.64088 11.9009 2.53008 10.6774C2.41928 9.45399 2.6107 8.22206 3.08751 7.08993C3.56432 5.95779 4.31192 4.96011 5.2646 4.18457C6.21729 3.40902 7.34589 2.87936 8.55121 2.64214C9.75654 2.40492 11.0017 2.4674 12.1772 2.82409C13.3527 3.18078 14.4226 3.82076 15.2929 4.68777L17.4999 6.7034V4.37527C17.4999 4.20951 17.5658 4.05054 17.683 3.93333C17.8002 3.81612 17.9592 3.75027 18.1249 3.75027C18.2907 3.75027 18.4497 3.81612 18.5669 3.93333C18.6841 4.05054 18.7499 4.20951 18.7499 4.37527Z"/>
      </svg>
    </button>
    
    <!-- Mute button - Speaker icon -->
    <button class="footer-icon-btn" id="muteBtn" data-tooltip="Mute">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12.7742 1.93815C12.6691 1.88694 12.5518 1.86623 12.4355 1.87839C12.3192 1.89054 12.2086 1.93507 12.1164 2.0069L6.66016 6.24987H3.125C2.79348 6.24987 2.47554 6.38157 2.24112 6.61599C2.0067 6.85041 1.875 7.16835 1.875 7.49987V12.4999C1.875 12.8314 2.0067 13.1493 2.24112 13.3838C2.47554 13.6182 2.79348 13.7499 3.125 13.7499H6.66016L12.1164 17.9928C12.2087 18.0646 12.3194 18.1091 12.4357 18.1211C12.552 18.1331 12.6694 18.1123 12.7745 18.0609C12.8795 18.0096 12.9681 17.9298 13.03 17.8306C13.092 17.7314 13.1249 17.6168 13.125 17.4999V2.49987C13.125 2.38279 13.0921 2.26805 13.0301 2.16874C12.9681 2.06942 12.8794 1.98953 12.7742 1.93815ZM11.875 16.2217L7.25859 12.6319C7.14914 12.5461 7.01405 12.4996 6.875 12.4999H3.125V7.49987H6.875C7.01405 7.5001 7.14914 7.4536 7.25859 7.36784L11.875 3.778V16.2217ZM19.8172 11.4327C19.9345 11.55 20.0003 11.709 20.0003 11.8749C20.0003 12.0407 19.9345 12.1998 19.8172 12.3171C19.6999 12.4343 19.5409 12.5002 19.375 12.5002C19.2091 12.5002 19.0501 12.4343 18.9328 12.3171L17.5 10.8835L16.0672 12.3171C15.9499 12.4343 15.7909 12.5002 15.625 12.5002C15.4591 12.5002 15.3001 12.4343 15.1828 12.3171C15.0655 12.1998 14.9997 12.0407 14.9997 11.8749C14.9997 11.709 15.0655 11.55 15.1828 11.4327L16.6164 9.99987L15.1828 8.56706C15.0655 8.44979 14.9997 8.29073 14.9997 8.12487C14.9997 7.95902 15.0655 7.79996 15.1828 7.68269C15.3001 7.56541 15.4591 7.49953 15.625 7.49953C15.7909 7.49953 15.9499 7.56541 16.0672 7.68269L17.5 9.11628L18.9328 7.68269C19.0501 7.56541 19.2091 7.49953 19.375 7.49953C19.5409 7.49953 19.6999 7.56541 19.8172 7.68269C19.9345 7.79996 20.0003 7.95902 20.0003 8.12487C20.0003 8.29073 19.9345 8.44979 19.8172 8.56706L18.3836 9.99987L19.8172 11.4327Z"/>
      </svg>
    </button>
  </div>
  

  <script>
    // =====================================================
    // INSTRUMENT CONFIGURATION
    // =====================================================
    // Mellow focus instruments - C major pentatonic (C, D, E, G, A)
    const INSTRUMENTS = [
      { id: 'softpad', name: 'Soft Pad', note: 'C3', type: 'softpad' },
      { id: 'piano', name: 'Muted Piano', note: 'E4', type: 'piano' },
      { id: 'drone', name: 'Ambient Drone', note: 'G2', type: 'drone' },
      { id: 'bells', name: 'Soft Bells', note: 'G4', type: 'bells' },
      { id: 'bass', name: 'Lo-fi Bass', note: 'C3', type: 'bass' },
      { id: 'kalimba', name: 'Soft Kalimba', note: 'A4', type: 'kalimba' },
      { id: 'breath', name: 'Breath Pad', note: 'G3', type: 'breath' },
      { id: 'guitar', name: 'Muted Guitar', note: 'E3', type: 'guitar' },
      { id: 'shaker', name: 'Subtle Shaker', note: 'C4', type: 'shaker' },
      { id: 'rain', name: 'Rain Texture', note: 'C4', type: 'rain' }
    ];

    const STEPS = 16;
    const DEFAULT_BPM = 70; // Slower for focus music
    const MIN_BPM = 50;
    const MAX_BPM = 120;
    const DEFAULT_VOLUME = -30; // dB - soft for focus music

    // =====================================================
    // STATE
    // =====================================================
    let grid = {};
    let synths = {};
    let sequence = null;
    let isPlaying = false;
    let currentStep = 0;
    let isMuted = false;
    let bpm = DEFAULT_BPM;

    // Timer state
    let timerInterval = null;
    let remainingSeconds = 0;
    let selectedMinutes = 15;
    let isTimerRunning = false;
    let hasInteractedWithTime = false; // Track if user has changed time selector

    // Drag state for pixel grid
    let isDragging = false;
    let dragActivate = true; // true = activating pixels, false = deactivating

    // =====================================================
    // DOM ELEMENTS
    // =====================================================
    const pixelGrid = document.getElementById('pixelGrid');
    const timerDisplay = document.getElementById('timer');
    const startBtn = document.getElementById('startBtn');
    const timeSelector = document.getElementById('timeSelector');
    const timeValue = document.getElementById('timeValue');
    const decreaseTimeBtn = document.getElementById('decreaseTime');
    const increaseTimeBtn = document.getElementById('increaseTime');
    const timerControls = document.getElementById('timerControls');
    const pauseBtn = document.getElementById('pauseBtn');
    const restartBtn = document.getElementById('restartBtn');
    const playBtn = document.getElementById('playBtn');
    const playIcon = document.getElementById('playIcon');
    const tempoKnob = document.getElementById('tempoKnob');
    const tempoLabel = document.getElementById('tempoLabel');
    const randomiseBtn = document.getElementById('randomiseBtn');
    const clearBtn = document.getElementById('clearBtn');
    const muteBtn = document.getElementById('muteBtn');
    // Time options in minutes
    const TIME_OPTIONS = [5, 15, 30, 45, 60];

    // =====================================================
    // INITIALIZE SYNTHS - Mellow Focus Sounds
    // =====================================================
    
    // Global reverb for spaciousness
    const reverb = new Tone.Reverb({
      decay: 4,
      wet: 0.5
    }).toDestination();
    
    // Gentle filter to remove harshness
    const filter = new Tone.Filter({
      frequency: 3500,
      type: 'lowpass',
      rolloff: -12
    }).connect(reverb);
    
    // =====================================================
    // UI SOUNDS
    // =====================================================
    
    // Subtle click sound for buttons (shaker-like quick click)
    const clickFilter = new Tone.Filter({
      frequency: 4000,
      type: 'bandpass',
      Q: 1
    }).toDestination();
    const clickSynth = new Tone.NoiseSynth({
      noise: { type: 'white' },
      envelope: {
        attack: 0.001,
        decay: 0.03,
        sustain: 0,
        release: 0.02
      }
    }).connect(clickFilter);
    clickSynth.volume.value = -18;
    
    // Alarm sound for timer completion (tring tring bell)
    const alarmSynth = new Tone.FMSynth({
      harmonicity: 8,
      modulationIndex: 2,
      oscillator: { type: 'sine' },
      envelope: {
        attack: 0.001,
        decay: 0.5,
        sustain: 0.1,
        release: 0.8
      },
      modulation: { type: 'sine' },
      modulationEnvelope: {
        attack: 0.002,
        decay: 0.2,
        sustain: 0.1,
        release: 0.5
      }
    }).toDestination();
    alarmSynth.volume.value = -5; // Louder for alarm
    
    // Play subtle click sound
    async function playClickSound() {
      if (isMuted) return;
      if (Tone.context.state !== 'running') {
        await Tone.start();
      }
      clickSynth.triggerAttackRelease('32n');
    }
    
    // Play alarm sound (tring tring pattern)
    async function playAlarmSound() {
      if (Tone.context.state !== 'running') {
        await Tone.start();
      }
      // Play a pleasant bell pattern - tring tring
      const now = Tone.now();
      alarmSynth.triggerAttackRelease('E5', '8n', now);
      alarmSynth.triggerAttackRelease('G5', '8n', now + 0.15);
      alarmSynth.triggerAttackRelease('E5', '8n', now + 0.6);
      alarmSynth.triggerAttackRelease('G5', '8n', now + 0.75);
      alarmSynth.triggerAttackRelease('C6', '4n', now + 1.2);
    }

    function initSynths() {
      INSTRUMENTS.forEach(inst => {
        let synth;
        
        switch (inst.type) {
          case 'softpad':
            // Warm, evolving pad with slow attack
            synth = new Tone.PolySynth(Tone.Synth, {
              oscillator: { type: 'sine' },
              envelope: {
                attack: 0.8,
                decay: 1.5,
                sustain: 0.6,
                release: 2.5
              }
            }).connect(filter);
            break;
            
          case 'piano':
            // Soft, muted piano-like tone
            synth = new Tone.Synth({
              oscillator: { type: 'triangle' },
              envelope: {
                attack: 0.02,
                decay: 1.2,
                sustain: 0.1,
                release: 1.5
              }
            }).connect(filter);
            break;
            
          case 'drone':
            // Deep ambient drone
            synth = new Tone.Synth({
              oscillator: { type: 'sine' },
              envelope: {
                attack: 1.5,
                decay: 2,
                sustain: 0.8,
                release: 3
              }
            }).connect(filter);
            break;
            
          case 'bells':
            // Soft, gentle bells
            synth = new Tone.FMSynth({
              harmonicity: 8,
              modulationIndex: 2,
              oscillator: { type: 'sine' },
              envelope: {
                attack: 0.01,
                decay: 2,
                sustain: 0.1,
                release: 2.5
              },
              modulation: { type: 'sine' },
              modulationEnvelope: {
                attack: 0.5,
                decay: 1,
                sustain: 0.2,
                release: 1.5
              }
            }).connect(filter);
            break;
            
          case 'bass':
            // Warm lo-fi bass
            synth = new Tone.MonoSynth({
              oscillator: { type: 'sine' },
              envelope: {
                attack: 0.1,
                decay: 0.5,
                sustain: 0.6,
                release: 1.2
              },
              filterEnvelope: {
                attack: 0.1,
                decay: 0.3,
                sustain: 0.4,
                release: 0.8,
                baseFrequency: 120,
                octaves: 1.5
              }
            }).connect(filter);
            break;
            
          case 'rain':
            // Rain/texture - filtered noise
            synth = new Tone.NoiseSynth({
              noise: { type: 'pink' },
              envelope: {
                attack: 0.3,
                decay: 0.5,
                sustain: 0.3,
                release: 1.5
              }
            }).connect(new Tone.Filter({
              frequency: 1200,
              type: 'lowpass'
            }).connect(filter));
            break;
            
          case 'kalimba':
            // Soft kalimba/thumb piano
            synth = new Tone.FMSynth({
              harmonicity: 4,
              modulationIndex: 1.5,
              oscillator: { type: 'sine' },
              envelope: {
                attack: 0.001,
                decay: 1.5,
                sustain: 0.05,
                release: 2
              },
              modulation: { type: 'triangle' },
              modulationEnvelope: {
                attack: 0.002,
                decay: 0.8,
                sustain: 0.1,
                release: 1
              }
            }).connect(filter);
            break;
            
          case 'breath':
            // Breathy pad texture
            synth = new Tone.Synth({
              oscillator: { type: 'sine' },
              envelope: {
                attack: 1,
                decay: 1.5,
                sustain: 0.5,
                release: 2
              }
            }).connect(new Tone.Filter({
              frequency: 2000,
              type: 'lowpass',
              Q: 2
            }).connect(filter));
            break;
            
          case 'guitar':
            // Soft muted guitar pluck
            synth = new Tone.PluckSynth({
              attackNoise: 0.5,
              dampening: 2000,
              resonance: 0.95,
              release: 1.5
            }).connect(filter);
            break;
            
          case 'shaker':
            // Subtle shaker/texture
            synth = new Tone.NoiseSynth({
              noise: { type: 'white' },
              envelope: {
                attack: 0.005,
                decay: 0.15,
                sustain: 0.02,
                release: 0.3
              }
            }).connect(new Tone.Filter({
              frequency: 3000,
              type: 'highpass'
            }).connect(new Tone.Filter({
              frequency: 6000,
              type: 'lowpass'
            }).connect(filter)));
            break;
        }
        
        synth.volume.value = DEFAULT_VOLUME;
        synths[inst.id] = synth;
      });
      
      // Initialize reverb
      reverb.generate();
    }

    // =====================================================
    // INITIALIZE GRID STATE
    // =====================================================
    function initGrid() {
      // Start with empty grid - no active pixels
      INSTRUMENTS.forEach((inst) => {
        grid[inst.id] = new Array(STEPS).fill(false);
      });
    }

    // =====================================================
    // CREATE PIXEL GRID UI
    // =====================================================
    function createPixelGrid() {
      pixelGrid.innerHTML = '';
      
      for (let row = 0; row < INSTRUMENTS.length; row++) {
        for (let col = 0; col < STEPS; col++) {
          const pixel = document.createElement('div');
          pixel.className = 'pixel';
          pixel.dataset.row = row;
          pixel.dataset.col = col;
          pixel.dataset.instrument = INSTRUMENTS[row].id;
          
          // Set initial state
          if (grid[INSTRUMENTS[row].id][col]) {
            pixel.classList.add('active');
          }
          
          pixelGrid.appendChild(pixel);
        }
      }
    }

    // =====================================================
    // DRAG INTERACTION FOR PIXELS
    // =====================================================
    function setupDragInteraction() {
      // Prevent text selection while dragging
      pixelGrid.style.userSelect = 'none';
      pixelGrid.style.webkitUserSelect = 'none';

      // Mouse down - start drag
      pixelGrid.addEventListener('mousedown', (e) => {
        const pixel = e.target.closest('.pixel');
        if (!pixel) return;
        
        e.preventDefault();
        isDragging = true;
        
        const row = parseInt(pixel.dataset.row);
        const col = parseInt(pixel.dataset.col);
        const instrumentId = INSTRUMENTS[row].id;
        
        // Determine if we're activating or deactivating based on current state
        dragActivate = !grid[instrumentId][col];
        
        // Toggle this pixel and play sound
        setCell(row, col, dragActivate);
      });

      // Mouse move - continue drag
      pixelGrid.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        
        const pixel = e.target.closest('.pixel');
        if (!pixel) return;
        
        const row = parseInt(pixel.dataset.row);
        const col = parseInt(pixel.dataset.col);
        const instrumentId = INSTRUMENTS[row].id;
        
        // Only update if state is different from drag direction
        if (grid[instrumentId][col] !== dragActivate) {
          setCell(row, col, dragActivate);
        }
      });

      // Mouse up - end drag (on document to catch release outside grid)
      document.addEventListener('mouseup', () => {
        isDragging = false;
      });

      // Touch support for mobile
      pixelGrid.addEventListener('touchstart', (e) => {
        const touch = e.touches[0];
        const pixel = document.elementFromPoint(touch.clientX, touch.clientY);
        if (!pixel || !pixel.classList.contains('pixel')) return;
        
        e.preventDefault();
        isDragging = true;
        
        const row = parseInt(pixel.dataset.row);
        const col = parseInt(pixel.dataset.col);
        const instrumentId = INSTRUMENTS[row].id;
        
        dragActivate = !grid[instrumentId][col];
        setCell(row, col, dragActivate);
      }, { passive: false });

      pixelGrid.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        
        const touch = e.touches[0];
        const pixel = document.elementFromPoint(touch.clientX, touch.clientY);
        if (!pixel || !pixel.classList.contains('pixel')) return;
        
        const row = parseInt(pixel.dataset.row);
        const col = parseInt(pixel.dataset.col);
        const instrumentId = INSTRUMENTS[row].id;
        
        if (grid[instrumentId][col] !== dragActivate) {
          setCell(row, col, dragActivate);
        }
      }, { passive: false });

      document.addEventListener('touchend', () => {
        isDragging = false;
      });
    }

    // =====================================================
    // SET CELL (with sound preview)
    // =====================================================
    function setCell(row, col, active) {
      const instrumentId = INSTRUMENTS[row].id;
      grid[instrumentId][col] = active;
      
      // Update visual
      const pixel = pixelGrid.children[row * STEPS + col];
      pixel.classList.toggle('active', active);
      
      // Play sound preview when activating
      if (active && !isMuted) {
        playPreviewSound(row);
      }
    }

    // =====================================================
    // PLAY PREVIEW SOUND
    // =====================================================
    async function playPreviewSound(row) {
      const inst = INSTRUMENTS[row];
      const synth = synths[inst.id];
      
      if (!synth) return;
      
      // Ensure audio context is started (required for browsers)
      if (Tone.context.state !== 'running') {
        await Tone.start();
      }
      
      try {
        // Play a short preview note (longer for mellow sounds)
        const duration = '4n'; // Quarter note for smoother preview
        if (inst.type === 'rain' || inst.type === 'shaker') {
          synth.triggerAttackRelease(duration);
        } else {
          synth.triggerAttackRelease(inst.note, duration);
        }
      } catch (e) {
        console.log('Sound preview error:', e);
      }
    }

    // =====================================================
    // TOGGLE CELL
    // =====================================================
    function toggleCell(row, col) {
      const instrumentId = INSTRUMENTS[row].id;
      const newState = !grid[instrumentId][col];
      setCell(row, col, newState);
    }

    // =====================================================
    // UPDATE PLAYHEAD VISUAL
    // =====================================================
    function updatePlayhead(step) {
      // Remove previous playhead
      document.querySelectorAll('.pixel.current-step').forEach(p => {
        p.classList.remove('current-step');
      });
      
      // Add playhead to current step column
      for (let row = 0; row < INSTRUMENTS.length; row++) {
        const pixel = pixelGrid.children[row * STEPS + step];
        pixel.classList.add('current-step');
      }
    }

    function clearPlayhead() {
      document.querySelectorAll('.pixel.current-step').forEach(p => {
        p.classList.remove('current-step');
      });
    }

    // =====================================================
    // CHECK IF GRID HAS ANY ACTIVE CELLS
    // =====================================================
    function hasActiveCells() {
      return Object.values(grid).some(track => track.some(step => step === true));
    }

    // =====================================================
    // SEQUENCE / PLAYBACK
    // =====================================================
    function createSequence() {
      if (sequence) {
        sequence.dispose();
      }
      
      sequence = new Tone.Sequence(
        (time, step) => {
          currentStep = step;
          
          // Update playhead visual (schedule slightly ahead for visual sync)
          Tone.Draw.schedule(() => {
            updatePlayhead(step);
          }, time);
          
          // Trigger active instruments
          INSTRUMENTS.forEach(inst => {
            if (grid[inst.id][step]) {
              const synth = synths[inst.id];
              // Longer durations for mellow, sustained sounds
              const duration = (inst.type === 'softpad' || inst.type === 'drone' || inst.type === 'breath') ? '2n' : '4n';
              
              if (inst.type === 'rain' || inst.type === 'shaker') {
                synth.triggerAttackRelease(duration, time);
              } else {
                synth.triggerAttackRelease(inst.note, duration, time);
              }
            }
          });
        },
        [...Array(STEPS).keys()], // [0, 1, 2, ... 15]
        '16n'
      );
      
      sequence.loop = true;
    }

    async function startPlayback() {
      if (!hasActiveCells()) {
        alert('Add some beats to the grid first!');
        return false;
      }
      
      try {
        await Tone.start();
        createSequence();
        Tone.Transport.bpm.value = bpm;
        sequence.start(0);
        Tone.Transport.start();
        isPlaying = true;
        updatePlayButton();
        return true;
      } catch (error) {
        console.error('Error starting playback:', error);
        return false;
      }
    }

    function pausePlayback() {
      Tone.Transport.pause();
      isPlaying = false;
      updatePlayButton();
    }

    function stopPlayback() {
      Tone.Transport.stop();
      if (sequence) {
        sequence.stop();
      }
      isPlaying = false;
      currentStep = 0;
      clearPlayhead();
      updatePlayButton();
    }

    function updatePlayButton() {
      if (isPlaying) {
        // Show pause icon
        playIcon.innerHTML = `
          <rect x="3" y="2" width="4" height="12" fill="#222"/>
          <rect x="9" y="2" width="4" height="12" fill="#222"/>
        `;
        playBtn.classList.add('playing');
      } else {
        // Show play icon
        playIcon.innerHTML = `
          <path d="M4 2L14 8L4 14V2Z" fill="#222" stroke="#222" stroke-width="1.5" stroke-linejoin="round"/>
        `;
        playBtn.classList.remove('playing');
      }
    }

    // =====================================================
    // TEMPO CONTROL
    // =====================================================
    function updateTempo(newBpm) {
      bpm = Math.max(MIN_BPM, Math.min(MAX_BPM, newBpm));
      Tone.Transport.bpm.value = bpm;
      tempoLabel.textContent = `${Math.round(bpm)} BPM`;
      updateTempoKnobPosition();
    }

    function updateTempoKnobPosition() {
      // Map BPM to knob position (0 = top = fast, 56 = bottom = slow)
      const range = MAX_BPM - MIN_BPM;
      const normalized = (bpm - MIN_BPM) / range;
      const knobTop = (1 - normalized) * 56; // Invert so up = faster
      tempoKnob.style.top = knobTop + 'px';
    }

    function initTempoControl() {
      let isDragging = false;
      const tempoControl = document.querySelector('.tempo-control');
      
      updateTempoKnobPosition();
      
      tempoKnob.addEventListener('mousedown', (e) => {
        isDragging = true;
        e.preventDefault();
      });
      
      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        
        const rect = tempoControl.getBoundingClientRect();
        let y = e.clientY - rect.top;
        y = Math.max(0, Math.min(56, y));
        
        // Map position to BPM (inverted: top = fast)
        const normalized = 1 - (y / 56);
        const newBpm = MIN_BPM + normalized * (MAX_BPM - MIN_BPM);
        updateTempo(newBpm);
      });
      
      document.addEventListener('mouseup', () => {
        isDragging = false;
      });
      
      // Touch support
      tempoKnob.addEventListener('touchstart', (e) => {
        isDragging = true;
        e.preventDefault();
      });
      
      document.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        
        const rect = tempoControl.getBoundingClientRect();
        let y = e.touches[0].clientY - rect.top;
        y = Math.max(0, Math.min(56, y));
        
        const normalized = 1 - (y / 56);
        const newBpm = MIN_BPM + normalized * (MAX_BPM - MIN_BPM);
        updateTempo(newBpm);
      });
      
      document.addEventListener('touchend', () => {
        isDragging = false;
      });
    }

    // =====================================================
    // TIMER FUNCTIONALITY
    // =====================================================
    function formatTime(seconds) {
      const hrs = Math.floor(seconds / 3600);
      const mins = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    let previousTimeString = '';

    function updateTimerDisplay() {
      const timeString = formatTime(remainingSeconds);
      timerDisplay.classList.toggle('active', remainingSeconds > 0 || isTimerRunning);
      
      // Build the HTML with individual digit spans
      let html = '';
      for (let i = 0; i < timeString.length; i++) {
        const char = timeString[i];
        const prevChar = previousTimeString[i] || '';
        const hasChanged = char !== prevChar && previousTimeString.length > 0;
        
        if (char === ':') {
          html += `<span class="timer-colon">:</span>`;
        } else {
          html += `<span class="timer-digit"><span class="timer-digit-inner${hasChanged ? ' changing' : ''}">${char}</span></span>`;
        }
      }
      
      timerDisplay.innerHTML = html;
      previousTimeString = timeString;
    }

    function startTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
      }
      
      remainingSeconds = selectedMinutes * 60;
      isTimerRunning = true;
      updateTimerDisplay();
      
      timerInterval = setInterval(() => {
        if (!isPlaying) return; // Only countdown while playing
        
        remainingSeconds--;
        updateTimerDisplay();
        
        if (remainingSeconds <= 0) {
          // Timer completed
          clearInterval(timerInterval);
          timerInterval = null;
          isTimerRunning = false;
          stopPlayback();
          updateTimerDisplay();
          showTimerStoppedControls();
          pauseBtn.textContent = 'Pause';
          // Small delay to ensure audio context is ready
          setTimeout(() => playAlarmSound(), 100);
        }
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      isTimerRunning = false;
      remainingSeconds = 0;
      updateTimerDisplay();
    }

    // =====================================================
    // PRESET PATTERNS - Cute Pixel Art
    // =====================================================
    const PRESET_PATTERNS = [
      // Pattern 1 - Heart 
      [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // row 0 (empty)
        [0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0], // row 1
        [0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,0], // row 2
        [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0], // row 3
        [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0], // row 4
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0], // row 5
        [0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0], // row 6
        [0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0], // row 7
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // row 8
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // row 9
      ],
      // Pattern 2 - Smiley Face 
      [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // row 0 (empty)
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0], // top of head
        [0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0], // sides
        [0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0], // eyes
        [0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0], // middle
        [0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0], // mouth corners
        [0,0,0,1,0,0,1,1,1,1,0,0,1,0,0,0], // smile
        [0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0], // sides
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0], // bottom
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // row 9 (empty)
      ],
      // Pattern 3 - Music Note 
      [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0], // row 0 (empty)
        [0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0], // note head top
        [0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0], // 
        [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0], // stem
        [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0], // stem
        [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0], // stem
        [0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0], // bottom note
        [0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0], // 
        [0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0], // bottom curve
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]  // row 9 (empty)
      ]
    ];

    let presetPatternIndex = 0;

    // =====================================================
    // PATTERN TOOLS
    // =====================================================
    function randomisePattern() {
      if (presetPatternIndex < PRESET_PATTERNS.length) {
        // Show preset pattern
        const pattern = PRESET_PATTERNS[presetPatternIndex];
        INSTRUMENTS.forEach((inst, row) => {
          grid[inst.id] = pattern[row].map(v => v === 1);
        });
        presetPatternIndex++;
      } else {
        // Show random pattern
        INSTRUMENTS.forEach(inst => {
          for (let i = 0; i < STEPS; i++) {
            grid[inst.id][i] = Math.random() < 0.22;
          }
        });
      }
      createPixelGrid();
    }

    function clearPattern() {
      INSTRUMENTS.forEach(inst => {
        grid[inst.id] = new Array(STEPS).fill(false);
      });
      createPixelGrid();
    }

    function toggleMute() {
      isMuted = !isMuted;
      
      Object.values(synths).forEach(synth => {
        synth.volume.value = isMuted ? -Infinity : DEFAULT_VOLUME;
      });
      
      muteBtn.classList.toggle('active', isMuted);
      muteBtn.dataset.tooltip = isMuted ? 'Unmute' : 'Mute';
    }

    // =====================================================
    // TIME SELECTOR FUNCTIONS
    // =====================================================
    function updateTimeDisplay() {
      if (selectedMinutes === 60) {
        timeValue.textContent = '1 hour';
      } else {
        timeValue.textContent = `${selectedMinutes} mins`;
      }
      updateArrowStates();
      
      // Update timer display to show selected time (only after user interaction, and when not running)
      if (!isTimerRunning && hasInteractedWithTime) {
        remainingSeconds = selectedMinutes * 60;
        updateTimerDisplay();
      }
    }

    function updateArrowStates() {
      const currentIndex = TIME_OPTIONS.indexOf(selectedMinutes);
      decreaseTimeBtn.disabled = currentIndex === 0;
      increaseTimeBtn.disabled = currentIndex === TIME_OPTIONS.length - 1;
    }

    function changeTime(delta) {
      const currentIndex = TIME_OPTIONS.indexOf(selectedMinutes);
      const newIndex = currentIndex + delta;
      
      if (newIndex >= 0 && newIndex < TIME_OPTIONS.length) {
        hasInteractedWithTime = true;
        selectedMinutes = TIME_OPTIONS[newIndex];
        updateTimeDisplay();
      }
    }

    function showTimerRunningControls() {
      timeSelector.style.display = 'none';
      startBtn.style.display = 'none';
      timerControls.style.display = 'flex';
    }

    function showTimerStoppedControls() {
      timeSelector.style.display = 'flex';
      startBtn.style.display = 'block';
      timerControls.style.display = 'none';
    }

    // =====================================================
    // EVENT LISTENERS
    // =====================================================
    function initEventListeners() {
      // Decrease time button (left arrow)
      decreaseTimeBtn.addEventListener('click', () => {
        playClickSound();
        changeTime(-1);
      });

      // Increase time button (right arrow)
      increaseTimeBtn.addEventListener('click', () => {
        playClickSound();
        changeTime(1);
      });

      // Click on time value to increment
      timeValue.addEventListener('click', () => {
        playClickSound();
        hasInteractedWithTime = true;
        const currentIndex = TIME_OPTIONS.indexOf(selectedMinutes);
        // Cycle through: if at max, go back to first
        const newIndex = (currentIndex + 1) % TIME_OPTIONS.length;
        selectedMinutes = TIME_OPTIONS[newIndex];
        updateTimeDisplay();
      });
      
      // Start button (starts timer + playback)
      startBtn.addEventListener('click', async () => {
        playClickSound();
        const started = await startPlayback();
        if (started) {
          startTimer();
          showTimerRunningControls();
        }
      });

      // Pause button
      pauseBtn.addEventListener('click', () => {
        playClickSound();
        if (isPlaying) {
          pausePlayback();
          pauseBtn.textContent = 'Resume';
        } else {
          startPlayback();
          pauseBtn.textContent = 'Pause';
        }
      });

      // Restart button
      restartBtn.addEventListener('click', () => {
        playClickSound();
        stopPlayback();
        stopTimer();
        showTimerStoppedControls();
        pauseBtn.textContent = 'Pause';
      });
      
      // Play button (just play/pause, no timer)
      playBtn.addEventListener('click', async () => {
        playClickSound();
        if (isPlaying) {
          pausePlayback();
        } else {
          await startPlayback();
        }
      });
      
      // Footer controls
      randomiseBtn.addEventListener('click', (e) => {
        e.preventDefault();
        playClickSound();
        randomisePattern();
      });
      
      clearBtn.addEventListener('click', (e) => {
        e.preventDefault();
        playClickSound();
        clearPattern();
        if (isPlaying && !hasActiveCells()) {
          stopPlayback();
        }
      });
      
      muteBtn.addEventListener('click', (e) => {
        e.preventDefault();
        playClickSound();
        toggleMute();
      });
    }

    // =====================================================
    // CLEANUP
    // =====================================================
    function cleanup() {
      if (sequence) {
        sequence.dispose();
      }
      Object.values(synths).forEach(synth => {
        synth.dispose();
      });
      if (timerInterval) {
        clearInterval(timerInterval);
      }
    }

    window.addEventListener('beforeunload', cleanup);

    // =====================================================
    // INITIALIZE
    // =====================================================
    function init() {
      initSynths();
      initGrid();
      createPixelGrid();
      setupDragInteraction(); // Setup once, works even after clear/randomize
      initTempoControl();
      initEventListeners();
      updateTimerDisplay();
      updateTimeDisplay(); // Initialize time selector display
    }

    // Start the app
    init();
  </script>
</body>
</html>
